<div class="flex m-4 gap-2">
    <div id="select_spendList" class="select select-sm select-bordered w-full">
        <span class="select-value"></span>
        <ul>
            {{#each spendList}}
            <li class="flex justify-between" data-value="{{this.Id}}">
                {{this.Name}}
                <button class="btn btn-ghost btn-sm text-error"
                    onclick="modal_spendList_delete.showModal();setTimeout(() => {$('#modal_spendList_delete').find('h3').text($('#select_spendList').selectControl('name'))}, 50);">
                    <i class="fa-sharp fa-trash"></i> Xoá
                </button>
            </li>
            {{/each}}
        </ul>
    </div>

    <button class="btn btn-active btn-sm" onclick="modal_spendList.showModal()">
        <i class="fa-sharp fa-plus"></i> Thêm
    </button>
</div>

<label class="input input-sm input-bordered flex items-center m-4 gap-2">
    <input type="text" class="grow" placeholder="Tìm kiếm" />
    <i class="fa-sharp fa-regular fa-magnifying-glass opacity-70"></i>
</label>

<div class="flex m-4 justify-between">
    <button class="btn btn-sm btn-accent" onclick="showSpendItemModal()">
        <i class="fa-sharp fa-plus"></i> Thêm chi tiêu
    </button>

    <label>Xếp theo:
        <div id="select_spendItem_sort" class="select select-sm select-bordered w-28">
            <span class="select-value"></span>
            <ul>
                <li data-value="AtUpdate">Thời gian</li>
                <li data-value="Name">Khoản chi</li>
                <li data-value="Price">Số tiền</li>
            </ul>
        </div>
    </label>
</div>

<div class="overflow-x-auto bg-base-100 rounded-box shadow m-4 h-[calc(100vh-52px-32px-32px-32px-32px-32px-16px-48px)]">
    <table id="table_spendItem" class="table table-sm table-pin-rows">
        <thead>
            <tr>
                <th class="text-base-content">Thời gian</th>
                <th class="text-base-content">Khoản chi</th>
                <th class="text-base-content">Số tiền</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <script type="text/x-handlebars-template" id="table_spendItem_template">
        %#each spendItems%
            <tr data-id="%this.Id%" class="hover cursor-pointer">
                <td>%formatDate this.AtUpdate 'dd/mm/yyyy' 'yyyy-mm-dd'%</td>
                <td>%this.Name%</td>
                <td>%formatCurrency this.Price%</td>
                <td class="hidden">%this.Details%</td>
                <td>
                    <details class="dropdown dropdown-left dropdown-end">
                        <summary tabindex="0" role="button" class="btn btn-sm btn-circle swap swap-rotate"
                            onclick="$(this).find('input[type=checkbox]').prop('checked', function(i, val) { return !val; })">
                            <input type="checkbox">

                            <i class="fa-sharp fa-regular fa-bars swap-off fill-current"></i>
                            <i class="fa-sharp fa-regular fa-xmark swap-on fill-current"></i>
                        </summary>

                        <ul class="menu dropdown-content bg-base-200 rounded-box z-[1] p-2 shadow flex gap-1">
                            <li><a class="btn btn-info btn-xs w-20" onclick="showSpendItemModal(%this.Id%)">Sửa</a></li>
                            <li><a class="btn btn-error btn-xs w-20" onclick="deleteSpendItem(%this.Id%)">Xoá</a></li>
                        </ul>
                    </details>
                </td>
            </tr>
        %/each%
    </script>
</div>

<!-- Modal Create SpendList -->
<dialog id="modal_spendList" class="modal">
    <div class="modal-box ">
        <h3 class="text-lg font-bold mb-3">Thêm danh sách chi tiêu</h3>
        <label class="input input-sm input-bordered flex items-center gap-2 mb-3">
            <i class="fa-sharp fa-solid fa-list opacity-70"></i>
            <input id="input_spendList_name" type="text" class="grow" placeholder="Tên danh sách" />
        </label>

        <div class="flex justify-end gap-2">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
                <button class="btn btn-sm w-20">Đóng</button>
            </form>

            <button id="btn_spendList_create" class="btn btn-sm btn-success w-20">Thêm</button>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<!-- Modal Delete SpendList -->
<dialog id="modal_spendList_delete" class="modal">
    <div class="modal-box ">
        <h3 class="text-lg font-bold mb-3"></h3>
        <p>Bạn có chắc muốn xoá danh sách này không?. Sau khi xoá sẽ không thể khôi phục lại dữ liệu</p>

        <div class="flex justify-end gap-2">
            <form method="dialog">
                <button class="btn btn-sm w-20">Đóng</button>
            </form>

            <button id="btn_spendList_delete" class="btn btn-sm btn-error w-20">Xoá</button>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<!-- Modal Create SpendItem -->
<dialog id="modal_spendItem" class="modal">
    <div class="modal-box">
        <h3 class="text-lg font-bold mb-3">Thêm chi tiêu</h3>

        <div class="flex gap-3 mb-3">
            <input id="input_spendItem_id" type="text" class="input input-sm input-bordered hidden" placeholder="Id">

            <label class="combobox w-[55%]">
                <input id="input_spendItem_name" type="text" class="input input-sm input-bordered w-full"
                    placeholder="Tên khoản chi">
                <i class="fa-sharp fa-regular fa-angles-up-down right-[5%!important] text-xs"></i>
                <ul>
                    <li>Option 1</li>
                    <li>Option 2</li>
                    <li>Option 3</li>
                </ul>
            </label>

            <label class="relative w-[45%]">
                <input id="input_spendItem_date" type="date" class="input input-sm input-bordered w-full"
                    placeholder="Thời gian" />
                <i class="fa-sharp fa-regular fa-calendar absolute right-[10%] top-[50%] translate-y-[-50%]"></i>
            </label>
        </div>

        <div class="flex gap-3 mb-3">
            <input id="input_spendItem_price" type="text" class="input input-sm input-bordered w-[45%]"
                placeholder="Số tiền" oninput="this.value = formatCurrency(this.value, false)">
            <input id="input_spendItem_info" type="text" class="input input-sm input-bordered w-[55%]"
                placeholder="Thông tin thêm">
        </div>

        <div class="flex justify-end gap-2">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
                <button class="btn btn-sm w-20">Đóng</button>
            </form>

            <button id="btn_spendItem_create" class="btn btn-sm btn-success w-20">Thêm</button>
            <button id="btn_spendItem_update" class="btn btn-sm btn-success w-20">Lưu</button>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<script>
    // Gán thời gian mặt định cho thẻ input[date]
    document.addEventListener('deviceready', function () {
        document.querySelectorAll('input[type="date"]').forEach(input => {
            input.value = new Date().toISOString().split('T')[0];
        });
    });
</script>
<script src="assets/js/spend.js"></script>